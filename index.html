<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sadak-Sathi v1.0 Integrated Map</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;}
#map{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0;}
.panel-transition{transition:all 0.4s ease;}
.card-hover:hover{transform:scale(1.03);transition:0.3s;}
#display-panel-content{overflow-y:auto;max-height:100%;scrollbar-width:none;-ms-overflow-style:none;}
#display-panel-content::-webkit-scrollbar{display:none;}
#left-panel,#route-finder,#right-panel,#onboard-panel{position:fixed;background:white;z-index:40;box-shadow:0 0 10px rgba(0,0,0,0.3);}
#left-panel{top:0;bottom:0;width:250px;transform:translateX(-100%);}
#route-finder{height:100px;left:0;right:0;top:60px;}
#right-panel{top:0;bottom:0;width:250px;right:-260px;}
#onboard-panel{bottom:20px;right:4px;width:320px;height:180px;border-radius:0.5rem;}
#bottom-menu{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);z-index:45;display:flex;gap:4px;}
.btn{cursor:pointer;padding:0.5rem;background-color:#3b82f6;color:white;border-radius:0.375rem;}
.ai-assistant{position:absolute;width:60px;height:60px;background:green;border-radius:50%;display:flex;justify-content:center;align-items:center;z-index:50;cursor:pointer;}
.language-dropdown{position:absolute;top:10px;right:60px;background:white;border:1px solid #ccc;border-radius:0.25rem;display:none;flex-direction:column;z-index:55;}
.language-dropdown button{padding:0.25rem 0.5rem;text-align:left;}
</style>
</head>
<body class="bg-gray-100">

<!-- Header -->
<div class="fixed top-0 left-0 right-0 flex items-center justify-between p-2 bg-white shadow z-50">
  <div class="flex items-center gap-2">
    <img src="header-icon.svg" alt="Logo" class="w-8 h-8"/>
    <span class="font-bold text-lg" data-i18n="appName">Sadak-Sathi</span>
  </div>
  <div class="flex items-center gap-2">
    <button id="dark-toggle" class="btn">🌙</button>
    <button id="lang-toggle" class="btn">🌐</button>
    <div id="lang-dropdown" class="language-dropdown">
      <button data-lang="en">English</button>
      <button data-lang="np">नेपाली</button>
      <button data-lang="hi">हिन्दी</button>
    </div>
  </div>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Display Panel -->
<div id="display-panel" class="fixed top-16 left-0 right-0 bg-white z-40 p-2 shadow-lg">
  <div class="flex justify-between items-center">
    <h3 class="font-bold text-lg" data-i18n="displayPanel">Display Panel</h3>
    <button id="bottom-left-toggle" class="btn">☰</button>
  </div>
  <div id="display-panel-content" class="flex flex-col gap-2 max-h-40 mt-2"></div>
</div>

<!-- Route Finder -->
<div id="route-finder" class="panel-transition p-2 bg-white shadow-lg z-35 flex justify-around items-center">
  <input type="text" placeholder="From" class="border p-1 rounded w-1/3" id="route-from"/>
  <input type="text" placeholder="To" class="border p-1 rounded w-1/3" id="route-to"/>
  <button class="btn" data-i18n="findRoute" id="find-route">Find</button>
</div>

<!-- Left Panel -->
<div id="left-panel" class="panel-transition p-4">
  <h3 class="font-bold mb-2" data-i18n="roadStatus">Road Status Menu</h3>
  <button class="btn w-full mb-2" data-i18n="allRoads">All Roads</button>
  <button class="btn w-full mb-2" data-i18n="blocked">Blocked</button>
  <button class="btn w-full mb-2" data-i18n="resumed">Resumed</button>
  <button class="btn w-full mb-2" data-i18n="oneLane">One-Lane</button>
</div>

<!-- Right Panel (Driver Mode) -->
<div id="right-panel" class="panel-transition p-4">
  <h3 class="font-bold mb-2" data-i18n="driverMode">Driver Mode</h3>
  <div id="compass" class="mb-2 p-2 bg-gray-200 rounded" data-i18n="compass">Compass: N</div>
  <div id="speedo" class="mb-2 p-2 bg-gray-200 rounded" data-i18n="speed">Speed: 0 km/h</div>
  <div id="weather" class="mb-2 p-2 bg-gray-200 rounded" data-i18n="weather">Weather: Clear</div>
  <button id="close-right" class="btn w-full" data-i18n="close">Close Driver Panel</button>
</div>

<!-- Onboard Panel -->
<div id="onboard-panel" class="panel-transition hidden p-4 bg-white shadow-lg">
  <h3 class="font-bold mb-2" data-i18n="onboardPanel">Onboard Panel</h3>
  <div class="flex flex-col gap-2">
    <div class="p-2 bg-gray-200 rounded">Speed</div>
    <div class="p-2 bg-gray-200 rounded">Fuel</div>
    <div class="p-2 bg-gray-200 rounded">Distance</div>
  </div>
</div>

<!-- Bottom Menu -->
<div id="bottom-menu">
  <button id="menu-home" class="btn">🏠</button>
  <button id="menu-passengers" class="btn">🧍‍♂️</button>
  <button id="menu-friends" class="btn">👨‍👩‍👧</button>
  <button id="menu-onboard" class="btn">🚗</button>
  <button id="menu-driver" class="btn">🛣️</button>
  <button id="menu-ai" class="btn">🤖</button>
</div>

<!-- AI Assistant -->
<div id="ai-assistant" class="ai-assistant hidden">🎤</div>

<script>
// Leaflet Map
var map = L.map('map').setView([28.3949,84.1240],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OSM'}).addTo(map);
var markersLayer=L.layerGroup().addTo(map);
var dorLayer=L.layerGroup().addTo(map);
var wazeLayer=L.layerGroup().addTo(map);

// Example DoR GeoJSON
var dorGeoJSON = {/* COMBINED GeoJSON from your files */};
L.geoJSON(dorGeoJSON,{
  style: function(feature){
    if(feature.properties.status==='Blocked') return {color:'red'};
    if(feature.properties.status==='One-Lane') return {color:'yellow'};
    return {color:'green'};
  },
  onEachFeature:function(feature,layer){
    layer.bindPopup(`<b>${feature.properties.name}</b><br>Status: ${feature.properties.status}`);
  }
}).addTo(dorLayer);

// Example: Fetch Google Sheet data
fetch("https://script.google.com/macros/s/AKfycbx6gmAt6XdIUqQstWfn1GdBTdAxXcsZkLwZ006ajJaCTRdlCgMzFa0Qw-di2IkKChxW/exec")
.then(r=>r.json()).then(data=>{
  if(data.status==='Success'){
    data.data.forEach(item=>{
      var marker=L.circleMarker([item.lat,item.lng],{color:item.status==='Blocked'?'red':'green',radius:6}).addTo(markersLayer);
      marker.bindPopup(`<b>${item.name}</b><br>Status: ${item.status}`);
      // Display Panel
      var div=document.createElement('div');
      div.className='p-2 bg-gray-100 rounded card-hover flex justify-between';
      div.innerHTML=`<span>${item.name}</span><button class="btn" onclick="map.setView([${item.lat},${item.lng}],14)">Go</button>`;
      document.getElementById('display-panel-content').appendChild(div);
    });
  }
});

// Fetch Waze incidents
fetch("https://www.waze.com/row-partnerhub-api/partners/19031804998/waze-feeds/75887a4e-e8fc-4329-a4c8-7f84be88914e?format=1")
.then(r=>r.json()).then(data=>{
  data.incidents.forEach(inc=>{
    var icon=L.divIcon({className:'bg-red-500 w-6 h-6 rounded-full'});
    var marker=L.marker([inc.location.lat,inc.location.lon],{icon}).addTo(wazeLayer);
    marker.bindPopup(`<b>${inc.type}</b><br>${inc.description}`);
  });
});

// Panels and toggles
document.getElementById('bottom-left-toggle').addEventListener('click', ()=>{
  const lp=document.getElementById('left-panel');
  lp.style.transform=(lp.style.transform==='translateX(0px)'?'translateX(-100%)':'translateX(0px)');
});
document.getElementById('menu-onboard').addEventListener('click',()=>{
  document.getElementById('onboard-panel').classList.toggle('hidden');
});
document.getElementById('menu-driver').addEventListener('click',()=>{
  document.getElementById('right-panel').style.right='0px';
});
document.getElementById('close-right').addEventListener('click',()=>{
  document.getElementById('right-panel').style.right='-260px';
});

// Dark/light toggle
document.getElementById('dark-toggle').addEventListener('click',()=>{
  document.body.classList.toggle('bg-gray-900');
  document.body.classList.toggle('text-white');
});

// Language dropdown
const langToggle=document.getElementById('lang-toggle');
const langDropdown=document.getElementById('lang-dropdown');
langToggle.addEventListener('click',()=>langDropdown.style.display=(langDropdown.style.display==='flex'?'none':'flex'));
langDropdown.querySelectorAll('button').forEach(btn=>{
  btn.addEventListener('click',()=>{alert('Language switched to '+btn.dataset.lang);langDropdown.style.display='none';});
});
</script>
</body>
</html>
